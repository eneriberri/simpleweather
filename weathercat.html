<!DOCTYPE html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link rel="stylesheet" href="css/foundation.css">
    <link href='https://fonts.googleapis.com/css?family=Lora|Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/weathercat.css">
  </head>
  <body>
    <div class="row weather-line input-wrapper">
      <div class="small-5 small-centered columns">
        <input type="text" placeholder="Where are you?" class="location-input" autofocus />
      </div>
    </div>

    <div class="row weather-line">
      <div class="large-3 columns weather-num-wrapper"></div>
      <div class="large-3 columns weather-num-wrapper"></div>
      <div class="large-3 columns weather-num-wrapper"></div>
      <div class="large-3 columns weather-num-wrapper"></div>
    </div>
    <div class="row weather-line">
      <div class="large-3 columns wind-speed"></div>
      <div class="large-3 columns wind-speed"></div>
      <div class="large-3 columns wind-speed"></div>
      <div class="large-3 columns wind-speed"></div>
    </div>
    <div class="row weather-line">
      <div class="large-3 columns condition"></div>
      <div class="large-3 columns condition"></div>
      <div class="large-3 columns condition"></div>
      <div class="large-3 columns condition"></div>
    </div>

  </body>
</html>

<script>
$(document).ready(function() {
  var getWeather = function(query) {
    $.ajax({
      url: 'https://query.yahooapis.com/v1/public/yql?q='+query+'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys',
      type: 'GET',
      success: function(res) {
        console.log(res);
        var results = res.query.results.channel;
        var condition = results.item.condition;
        var temp = condition.temp;
        var text = condition.text;
        var date = condition.date;
        var windSpeed = results.wind.speed;

        $('.wind-speed').html(windSpeed+' <span class="small-txt">mph wind</span>');
        $('.condition').html(text);

        $('body').css({'background-color': 'rgba(255, 255, 255, 0)'});
        $('.weather-line').fadeIn();

        console.log(temp);
        var tempStr = temp.toString();
        for(var i = 0; i < tempStr.length; i++) {
          var tempSingleDigit = tempStr[i];
          var lastDigit = (i === tempStr.length - 1);
          displayIncrementedNum(tempSingleDigit, 1000, lastDigit);
        }

      }
    });
  }

  var displayIncrementedNum = function(num,delay,lastDigit) {
    $('.weather-num-wrapper').append('<div class="weather-nums"></div>');
    var lastIndexOfEl = $('.weather-nums').length - 1;
    var $el = $($('.weather-nums')[lastIndexOfEl]);
    for(var i = 0; i <= num; i++) {
      //Append degree symbol to last digit
      if(lastDigit && i == num) i += '&#176;';
      $el.append('<span class="num num-'+i+'">'+i+'</span>');
    }
    var height = $el.height();
    var height = ($('.weather-nums').last().height() + 7) * -1;
    $el.animate({'position': 'relative', 'top': height+'px'}, delay);
  }

  $('.location-input').on('keypress', function(e) {
    //On enter, submit and animate form up
    if(e.keyCode === 13) {
      var query = 'select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="';
      //Ex) 'select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="san mateo")';

      // $(e.target).blur();

      $('.weather-nums').remove();

      var location = $(e.target).val();
      query += location + '")';
      getWeather(query);
    }
  });


});
</script>
